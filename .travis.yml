language: generic
services: docker
script:
  - touch .gitignore
  - >
    docker run --volume=$(pwd):/app --workdir=/app coala/base:0.8 /bin/bash -c
    "pip3 install 'git+https://github.com/jayvdb/coala-quickstart@gh_39';
    coala-quickstart --ci;
    yes 0 | coala --apply-patches --no-orig;
    coala-ci || true"
  - git add --all
  # Create two diff files, and upload to https://clbin.com
  - >
    git diff --cached --find-renames
    --ignore-all-space --ignore-blank-lines
    > sans-whitespace.diff
  - cat sans-whitespace.diff | curl -F 'clbin=<-' https://clbin.com
  - >
    git diff --cached --find-renames
    > with-whitespace.diff
  - cat with-whitespace.diff | curl -F 'clbin=<-' https://clbin.com
  # Show the generated .coafile
  - cat .coafile
  # Repeat to get the correct exit code for Travis build status
  - git diff --cached --find-renames --no-patch --exit-code
